apiVersion: 1

# Contact Points Configuration for Arbitrage Alerts
contactPoints:
  # Discord Webhook for alerts (configured via environment)
  - orgId: 1
    name: Discord Alerts
    receivers:
      - uid: discord_webhook
        type: discord
        settings:
          url: ${DISCORD_WEBHOOK_URL}
          title: "Arbitrage Alert"
          message: |
            **{{ .CommonLabels.alertname }}**

            {{ range .Alerts }}
            **Status:** {{ .Status }}
            **Severity:** {{ .Labels.severity }}
            **Component:** {{ .Labels.component }}

            {{ .Annotations.description }}

            {{ end }}
        disableResolveMessage: false

  # Webhook for testing and custom integrations
  - orgId: 1
    name: Custom Webhook
    receivers:
      - uid: custom_webhook
        type: webhook
        settings:
          url: ${GRAFANA_WEBHOOK_URL}
          httpMethod: POST
        disableResolveMessage: false

  # Email notifications (optional - configure SMTP in grafana.ini first)
  # Commented out until SMTP is configured
  # - orgId: 1
  #   name: Email Alerts
  #   receivers:
  #     - uid: email_alerts
  #       type: email
  #       settings:
  #         addresses: ${ALERT_EMAIL_ADDRESSES}
  #       disableResolveMessage: false

# Notification Policies
policies:
  - orgId: 1
    receiver: Discord Alerts
    group_by:
      - alertname
      - severity
    group_wait: 10s
    group_interval: 5m
    repeat_interval: 12h
    routes:
      # Critical alerts - immediate notification via Discord
      - receiver: Discord Alerts
        matchers:
          - severity = critical
        group_wait: 0s
        group_interval: 1m
        repeat_interval: 5m
        continue: true

      # Warning alerts - less frequent
      - receiver: Discord Alerts
        matchers:
          - severity = warning
        group_wait: 30s
        group_interval: 10m
        repeat_interval: 1h
        continue: true

      # Info alerts - high value opportunities
      - receiver: Discord Alerts
        matchers:
          - severity = info
          - alert_type = opportunity
        group_wait: 0s
        group_interval: 5m
        repeat_interval: 6h
        continue: false
