type Approval @entity(immutable: true) {
  id: Bytes!
  owner: Bytes!
  spender: Bytes!
  value: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Transfer @entity(immutable: true) {
  id: Bytes!
  from: Bytes!
  to: Bytes!
  value: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Token @entity(immutable: false) {
  id: Bytes!
  name: String
  symbol: String
  decimals: Int
  totalSupply: BigInt!
  holderCount: Int!
  transferCount: Int!
  totalVolume: BigInt!
  lastUpdatedBlock: BigInt!
  lastUpdatedTimestamp: BigInt!
  balances: [HolderBalance!]! @derivedFrom(field: "token")
  dailySnapshots: [DailySnapshot!]! @derivedFrom(field: "token")
}

type HolderBalance @entity(immutable: false) {
  id: ID!
  token: Token!
  holder: Bytes!
  balance: BigInt!
  firstSeenBlock: BigInt!
  lastUpdatedBlock: BigInt!
  lastUpdatedTimestamp: BigInt!
}

type DailySnapshot @entity(immutable: false) {
  id: ID!
  token: Token!
  date: Int!
  transferCount: Int!
  volume: BigInt!
  holderCount: Int!
  totalSupply: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
}

type Vault @entity(immutable: false) {
  id: Bytes!
  stakeToken: Bytes
  rewardToken: Bytes
  owner: Bytes
  totalStaked: BigInt!
  rewardRate: BigInt!
  periodFinish: BigInt!
  lastUpdate: BigInt!
  lastUpdatedBlock: BigInt!
  lastUpdatedTimestamp: BigInt!
  stakes: [StakeAction!]! @derivedFrom(field: "vault")
  withdrawals: [WithdrawAction!]! @derivedFrom(field: "vault")
  rewardPayments: [RewardPaidAction!]! @derivedFrom(field: "vault")
  rewardNotifications: [RewardNotification!]! @derivedFrom(field: "vault")
}

type StakeAction @entity(immutable: true) {
  id: Bytes!
  vault: Vault!
  user: Bytes!
  amount: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type WithdrawAction @entity(immutable: true) {
  id: Bytes!
  vault: Vault!
  user: Bytes!
  amount: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type RewardPaidAction @entity(immutable: true) {
  id: Bytes!
  vault: Vault!
  user: Bytes!
  reward: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type RewardNotification @entity(immutable: true) {
  id: Bytes!
  vault: Vault!
  amount: BigInt!
  duration: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

# ========== ARBITRAGE TRACKING ==========

type ArbitrageContract @entity(immutable: false) {
  id: Bytes!
  owner: Bytes!
  aavePool: Bytes!
  uniV3Router: Bytes!
  weth: Bytes!
  maxGasPrice: BigInt!
  slippageTolerance: BigInt!
  totalExecutions: Int!
  totalProfit: BigInt!
  totalGasCost: BigInt!
  createdBlock: BigInt!
  createdTimestamp: BigInt!
  lastUpdatedBlock: BigInt!
  lastUpdatedTimestamp: BigInt!
  executions: [ArbitrageExecution!]! @derivedFrom(field: "contract")
  flashLoans: [FlashLoanInitiated!]! @derivedFrom(field: "contract")
  profitabilityChecks: [ProfitabilityAnalysis!]! @derivedFrom(field: "contract")
  configUpdates: [ConfigUpdate!]! @derivedFrom(field: "contract")
  dailySnapshots: [DailyArbitrageSnapshot!]! @derivedFrom(field: "contract")
}

type ArbitrageExecution @entity(immutable: true) {
  id: Bytes!
  contract: ArbitrageContract!
  asset: Bytes!
  borrowAmount: BigInt!
  profit: BigInt!
  gasCost: BigInt!
  netProfit: BigInt!
  gasPrice: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type FlashLoanInitiated @entity(immutable: true) {
  id: Bytes!
  contract: ArbitrageContract!
  asset: Bytes!
  amount: BigInt!
  estimatedProfit: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type ProfitabilityAnalysis @entity(immutable: true) {
  id: Bytes!
  contract: ArbitrageContract!
  grossProfit: BigInt!
  flashLoanFee: BigInt!
  gasCost: BigInt!
  netProfit: BigInt!
  approved: Boolean!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type ConfigUpdate @entity(immutable: true) {
  id: Bytes!
  contract: ArbitrageContract!
  maxGasPrice: BigInt!
  slippageTolerance: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

# Daily aggregated arbitrage stats
type DailyArbitrageSnapshot @entity(immutable: false) {
  id: ID!
  contract: ArbitrageContract!
  date: Int!
  executionCount: Int!
  totalProfit: BigInt!
  totalGasCost: BigInt!
  netProfit: BigInt!
  avgProfitPerTrade: BigInt!
  successRate: BigDecimal!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
}
